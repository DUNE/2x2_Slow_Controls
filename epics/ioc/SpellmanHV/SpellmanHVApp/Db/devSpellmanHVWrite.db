record(ao, "spellmanhv/enable_hv"){
  field(DESC, "Enable HV")
  field(DTYP, "stream")
  field(OUT, "@devSpellmanHV.proto send_command $(PORT) $(BUS)")
  field(EGU, "Bits")
  field(SCAN, "Passive")
  field(PREC, "0")
  field(ADEL, "1")
  field(MDEL, "1")
  field(PINI, "NO")
}

record(ao, "spellmanhv/disable_hv"){
  field(DESC, "Disable HV")
  field(DTYP, "stream")
  field(OUT, "@devSpellmanHV.proto send_command $(PORT) $(BUS)")
  field(EGU, "Bits")
  field(SCAN, "Passive")
  field(PREC, "0")
  field(ADEL, "1")
  field(MDEL, "1")
  field(PINI, "NO")
}

record(ao, "spellmanhv/clear_faults"){
  field(DESC, "Clera Faults")
  field(DTYP, "stream")
  field(OUT, "@devSpellmanHV.proto send_command $(PORT) $(BUS)")
  field(EGU, "Bits")
  field(SCAN, "Passive")
  field(PREC, "0")
  field(ADEL, "1")
  field(MDEL, "1")
  field(PINI, "NO")
}

record(ao, "spellmanhv/targetV_kV"){
  field(DESC, "TargSet voltage")
  field(EGU, "kV")
  field(SCAN, "Passive")
  field(PREC, "3")
  field(ADEL, "0.1")
  field(MDEL, "0.001")
  field(HIHI, "40.0")
  field(HIGH, "35.0")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
  #field(FLNK, "spellmanhv/targetV_bit")
}

record(calcout, "spellmanhv/targetV_bit"){
  field(DESC, "TargSet voltage")
  field(INPA, "spellmanhv/targetV_kV")  
  field(CALC, "MIN((A / 0.01221 + 0.5) & 0xFFFFFFFF, 4095)")
  field(EGU, "Bits")
  field(SCAN, ".5 second")
  field(PREC, "0")
  field(ADEL, "0.1")
  field(MDEL, "0.1")
  field(HIHI, "150.0")
  field(HIGH, "150.0")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
}

record(ao, "spellmanhv/setV_bit"){
  field(DESC, "Setting voltage bit")
  field(DTYP, "stream")
  field(OUT, "@devSpellmanHV.proto set_v $(PORT) $(BUS)")
  field(EGU, "Bits")
  field(SCAN, ".5 second")
  field(PREC, "0")
  field(ADEL, "0.1")
  field(MDEL, "0.1")
  field(HIHI, "4095")
  field(HIGH, "4095")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
}

record(calcout, "spellmanhv/setV_kV"){
  field(DESC, "Set voltage")
  field(INPA, "spellmanhv/setV_bit")
  field(CALC, "A * 0.01221")
  field(EGU, "kV")
  field(SCAN, ".5 second")
  field(PREC, "3")
  field(ADEL, "0.1")
  field(MDEL, "0.001")
  field(HIHI, "150.0")
  field(HIGH, "150.0")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
}

record(ao, "spellmanhv/setI_bit"){
  field(DESC, "Set mA bit")
  field(DTYP, "stream")
  field(OUT, "@devSpellmanHV.proto set_i $(PORT) $(BUS)")
  field(EGU, "Bits")
  field(SCAN, ".5 second")
  field(PREC, "0")
  field(ADEL, "0.1")
  field(MDEL, "0.1")
  field(HIHI, "4095")
  field(HIGH, "4095")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
}

record(calcout, "spellmanhv/setI_mA"){
  field(DESC, "Set mA")
  field(INPA, "spellmanhv/setI_bit")
  field(CALC, "A * 0.0014652")
  field(EGU, "mA")
  field(SCAN, ".5 second")
  field(PREC, "3")
  field(ADEL, "0.1")
  field(MDEL, "0.1")
  field(HIHI, "150.0")
  field(HIGH, "150.0")
  field(LOW, "0.0")
  field(LOLO, "0.0")
  field(LLSV, MAJOR)
  field(LSV, MINOR)
  field(HSV, MINOR)
  field(HHSV, MAJOR)
  field(PINI, "NO")
  field(VAL, "0.0")
}

